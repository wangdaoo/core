<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proxy</title>
</head>
<body>
  <script>
    // 定义一个处理器对象，包含多个捕获器函数，用于拦截不同的操作
    const handler = {
      // 捕获属性读取操作
      get(target, key) {
        console.log(`Getting ${key}`);  // 输出正在读取的属性名
        return target[key]; // 返回目标对象中对应属性的值
      },

      // 捕获属性写入操作
      set(target, key, value) {
        console.log(`Setting ${key} to ${value}`);  // 输出正在写入的属性名和值
        target[key] = value + 1; // 将属性值设置为传入值 + 1
        return true; // 返回 true 表示写入成功
      },

      // 拦截 in 操作符
      has(target, key) {
        console.log(`Checking ${key} in target`); // 输出正在检查的属性名
        return key in target; // 返回属性是否存在于目标对象中
      },

      // 拦截 Object.keys 和 for...in 操作
      ownKeys(target) {
        console.log('Getting own keys'); // 输出正在获取对象的所有键
        return Object.keys(target); // 返回目标对象的所有键
      },

      // 拦截属性删除操作
      deleteProperty(target, key) {
        console.log(`Deleting ${key}`); // 输出正在删除的属性名
        delete target[key]; // 删除目标对象中对应的属性
        return true; // 返回 true 表示删除成功
      },
    };

    // 定义目标对象
    const target = {};
    // 创建代理对象，目标对象为 target，处理器为 handler
    const proxy = new Proxy(target, handler);

    // 设置 proxy.count = 1
    proxy.count = 1;
    // 控制台输出：Setting count to 1
    // 目标对象的 count 属性被设置为 2（1+1）

    // 读取 proxy.count 的值
    console.log(proxy.count);
    // 控制台输出：Getting count
    // 输出：2（因为前面 Set 时 加了 1）

    // 与上述同理
    proxy.count = 2;
    console.log(proxy.count); // 3
    // -----

    // 检查 count 属性是否存在于 proxy 对象中
    console.log('count' in proxy); // true
    // 控制台输出：Checking count in target
    // 输出：true，因为 count 属性存在于目标对象中

    // 检查 name 属性是否存在于 proxy 对象中
    console.log('name' in proxy); // false
    // 控制台输出：Checking name in target
    // 输出：false，因为 name 属性不存在于目标对象中

    // 设置 proxy.name = 'John'
    proxy.name = 'John';
    // 控制台输出：Setting name to John
    // 目标对象的 name 属性被设置为 'John1'（'John' + '1'）

    console.log(proxy.name);  // John1
    console.log(Object.keys(proxy));
    // 控制台输出：Getting own keys
    // 输出：['count', 'name']

    // 删除 proxy.count 属性
    delete proxy.count;
    // 控制台输出：Deleting count
    // 目标对象的 count 属性被删除

    console.log(proxy.count); // undefined

    console.log(Object.keys(proxy));
    // 控制台输出：Getting own keys
    // 输出：['name']
  </script>
</body>
</html>